{"ast":null,"code":"import _objectSpread from\"C:/Users/Administrator/Desktop/bika/bika/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from\"react\";import{Box,Typography,Button,Grid,Card,CardContent,IconButton,Dialog,DialogTitle,DialogContent,DialogActions,TextField,FormControlLabel,Switch,Select,MenuItem,FormControl,InputLabel,Chip,List,ListItem,ListItemText,ListItemSecondaryAction,Divider,CircularProgress,Alert}from\"@mui/material\";import{Add as AddIcon,Edit as EditIcon,Delete as DeleteIcon,AddCircle as AddCircleIcon}from\"@mui/icons-material\";import{tokens}from\"../../theme/theme\";import{useAuth}from\"../../context/AuthContext\";import{documentTypeService}from\"../../services/api\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const DocumentTypesPage=()=>{const{user}=useAuth();// State\nconst[documentTypes,setDocumentTypes]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[openDialog,setOpenDialog]=useState(false);const[editingDocType,setEditingDocType]=useState(null);const[newField,setNewField]=useState({name:\"\",fieldType:\"TEXT\",required:false});const[newOption,setNewOption]=useState(\"\");// Load document types on component mount\nuseEffect(()=>{loadDocumentTypes();},[user]);const loadDocumentTypes=async()=>{try{setLoading(true);setError(null);if(user!==null&&user!==void 0&&user.companyId){const data=await documentTypeService.getDocumentTypesByCompany(user.companyId);setDocumentTypes(data);}}catch(err){var _err$response,_err$response$data;console.error('Error loading document types:',err);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||err.message||'Failed to load document types');}finally{setLoading(false);}};const handleCreateNew=()=>{if(!(user!==null&&user!==void 0&&user.companyId)){setError('Company information is required');return;}setEditingDocType({name:\"\",code:\"\",description:\"\",companyId:user.companyId,fields:[],isActive:true});setOpenDialog(true);};const handleEdit=docType=>{setEditingDocType(docType);setOpenDialog(true);};const handleSave=async()=>{if(!editingDocType)return;try{setError(null);// Basic validation\nif(!editingDocType.name.trim()){setError('Document type name is required');return;}if(!editingDocType.code.trim()){setError('Document type code is required');return;}// Ensure display order is set for fields\nconst fieldsWithOrder=editingDocType.fields.map((field,index)=>_objectSpread(_objectSpread({},field),{},{displayOrder:field.displayOrder||index+1,fieldKey:field.fieldKey||documentTypeService.generateFieldKey(field.name)}));const documentTypeData=_objectSpread(_objectSpread({},editingDocType),{},{fields:fieldsWithOrder});if(editingDocType.id){// Update existing\nawait documentTypeService.updateDocumentType(editingDocType.id,documentTypeData);}else{// Create new\nawait documentTypeService.createDocumentType(documentTypeData);}setOpenDialog(false);setEditingDocType(null);await loadDocumentTypes();}catch(err){var _err$response2,_err$response2$data;console.error('Error saving document type:',err);setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.message)||'Failed to save document type');}};const handleDelete=async docType=>{if(!docType.id)return;if(window.confirm(\"Are you sure you want to delete \\\"\".concat(docType.name,\"\\\"?\"))){try{await documentTypeService.deleteDocumentType(docType.id);await loadDocumentTypes();}catch(err){var _err$response3,_err$response3$data;setError(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.message)||'Failed to delete document type');}}};const handleAddField=()=>{if(editingDocType&&newField.name){const field={name:newField.name,fieldKey:documentTypeService.generateFieldKey(newField.name),fieldType:newField.fieldType||\"TEXT\",required:newField.required||false,description:newField.description,active:true,displayOrder:editingDocType.fields.length+1,options:newField.fieldType===\"SELECT\"?[]:undefined};setEditingDocType(_objectSpread(_objectSpread({},editingDocType),{},{fields:[...editingDocType.fields,field]}));setNewField({name:\"\",fieldType:\"TEXT\",required:false});}};const handleAddOption=fieldIndex=>{if(editingDocType&&newOption.trim()){const updatedFields=[...editingDocType.fields];const field=updatedFields[fieldIndex];if(field.options){field.options=[...field.options,newOption.trim()];}else{field.options=[newOption.trim()];}setEditingDocType(_objectSpread(_objectSpread({},editingDocType),{},{fields:updatedFields}));setNewOption(\"\");}};const handleDeleteField=fieldIndex=>{if(editingDocType){const updatedFields=editingDocType.fields.filter((_,index)=>index!==fieldIndex);setEditingDocType(_objectSpread(_objectSpread({},editingDocType),{},{fields:updatedFields}));}};const handleDeleteOption=(fieldIndex,option)=>{if(editingDocType){const updatedFields=[...editingDocType.fields];const field=updatedFields[fieldIndex];if(field.options){field.options=field.options.filter(opt=>opt!==option);}setEditingDocType(_objectSpread(_objectSpread({},editingDocType),{},{fields:updatedFields}));}};const handleCloseDialog=()=>{setOpenDialog(false);setEditingDocType(null);setNewField({name:\"\",fieldType:\"TEXT\",required:false});setNewOption(\"\");setError(null);};if(loading){return/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"center\",alignItems:\"center\",minHeight:\"60vh\",children:[/*#__PURE__*/_jsx(CircularProgress,{}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{ml:2},children:\"Loading document types...\"})]});}return/*#__PURE__*/_jsxs(Box,{width:\"100%\",boxSizing:\"border-box\",p:3,children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\",mb:4,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",fontWeight:600,children:\"Document Types\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"secondary\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),onClick:handleCreateNew,sx:{fontWeight:600,boxShadow:2},children:\"Create New Document Type\"})]}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",onClose:()=>setError(null),sx:{mb:2},children:error}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:3,children:documentTypes.length===0?/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(Typography,{variant:\"body1\",color:\"text.secondary\",align:\"center\",sx:{py:4},children:\"No document types found. Create your first document type to get started.\"})}):documentTypes.map(docType=>{var _docType$fields;return/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,lg:4,children:/*#__PURE__*/_jsx(Card,{elevation:3,sx:{background:\"linear-gradient(135deg, \".concat(tokens.primary.light,\" 0%, \").concat(tokens.secondary.light,\" 100%)\"),color:tokens.grey[900],borderRadius:3,height:\"100%\",boxShadow:\"0 4px 24px 0 rgba(0,0,0,0.07)\",transition:\"transform 0.2s\",\"&:hover\":{transform:\"translateY(-4px) scale(1.02)\",boxShadow:\"0 8px 32px 0 rgba(0,0,0,0.12)\"}},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\",mb:2,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",fontWeight:600,children:docType.name}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(IconButton,{onClick:()=>handleEdit(docType),color:\"primary\",size:\"small\",children:/*#__PURE__*/_jsx(EditIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{onClick:()=>handleDelete(docType),color:\"error\",size:\"small\",children:/*#__PURE__*/_jsx(DeleteIcon,{fontSize:\"small\"})})]})]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.primary\",mb:2,children:docType.description||'No description'}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"text.secondary\",children:[\"Code: \",docType.code]}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"text.secondary\",display:\"block\",children:[\"Fields: \",((_docType$fields=docType.fields)===null||_docType$fields===void 0?void 0:_docType$fields.length)||0]})]})})},docType.id);})}),/*#__PURE__*/_jsxs(Dialog,{open:openDialog,onClose:handleCloseDialog,maxWidth:\"md\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:editingDocType!==null&&editingDocType!==void 0&&editingDocType.id?\"Edit Document Type\":\"Create New Document Type\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsx(Box,{sx:{mt:2},children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{label:\"Document Type Name\",fullWidth:true,required:true,value:(editingDocType===null||editingDocType===void 0?void 0:editingDocType.name)||\"\",onChange:e=>setEditingDocType(editingDocType?_objectSpread(_objectSpread({},editingDocType),{},{name:e.target.value}):null)})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{label:\"Code\",fullWidth:true,required:true,value:(editingDocType===null||editingDocType===void 0?void 0:editingDocType.code)||\"\",onChange:e=>setEditingDocType(editingDocType?_objectSpread(_objectSpread({},editingDocType),{},{code:e.target.value}):null),helperText:\"Unique identifier for the document type\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{label:\"Description\",fullWidth:true,multiline:true,rows:2,value:(editingDocType===null||editingDocType===void 0?void 0:editingDocType.description)||\"\",onChange:e=>setEditingDocType(editingDocType?_objectSpread(_objectSpread({},editingDocType),{},{description:e.target.value}):null)})}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Fields\"}),/*#__PURE__*/_jsx(List,{children:editingDocType===null||editingDocType===void 0?void 0:editingDocType.fields.map((field,fieldIndex)=>{var _field$options;return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemText,{primary:field.name,secondary:\"\".concat(field.fieldType.toLowerCase(),\" \").concat(field.required?\"(Required)\":\"\")}),/*#__PURE__*/_jsx(ListItemSecondaryAction,{children:/*#__PURE__*/_jsx(IconButton,{edge:\"end\",onClick:()=>handleDeleteField(fieldIndex),color:\"error\",children:/*#__PURE__*/_jsx(DeleteIcon,{})})})]}),field.fieldType===\"SELECT\"&&/*#__PURE__*/_jsxs(Box,{sx:{pl:4,pr:2,pb:2},children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",gap:1,mb:1,children:[/*#__PURE__*/_jsx(TextField,{size:\"small\",label:\"Add Option\",value:newOption,onChange:e=>setNewOption(e.target.value)}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"primary\",onClick:()=>handleAddOption(fieldIndex),disabled:!newOption,children:\"Add\"})]}),/*#__PURE__*/_jsx(Box,{display:\"flex\",gap:0.5,flexWrap:\"wrap\",children:(_field$options=field.options)===null||_field$options===void 0?void 0:_field$options.map(option=>/*#__PURE__*/_jsx(Chip,{label:option,onDelete:()=>handleDeleteOption(fieldIndex,option),color:\"secondary\"},option))})]}),/*#__PURE__*/_jsx(Divider,{})]},fieldIndex);})}),/*#__PURE__*/_jsxs(Box,{sx:{mt:2,p:2,border:\"1px dashed \".concat(tokens.grey[300])},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",gutterBottom:true,children:\"Add New Field\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,alignItems:\"center\",children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:4,children:/*#__PURE__*/_jsx(TextField,{label:\"Field Name\",fullWidth:true,value:newField.name,onChange:e=>setNewField(_objectSpread(_objectSpread({},newField),{},{name:e.target.value}))})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:3,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Type\"}),/*#__PURE__*/_jsxs(Select,{value:newField.fieldType,label:\"Type\",onChange:e=>setNewField(_objectSpread(_objectSpread({},newField),{},{fieldType:e.target.value})),children:[/*#__PURE__*/_jsx(MenuItem,{value:\"TEXT\",children:\"Text\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"TEXTAREA\",children:\"Text Area\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"NUMBER\",children:\"Number\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"DATE\",children:\"Date\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"SELECT\",children:\"Select\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"CHECKBOX\",children:\"Checkbox\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"EMAIL\",children:\"Email\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"PHONE\",children:\"Phone\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"URL\",children:\"URL\"})]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:3,children:/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:newField.required,onChange:e=>setNewField(_objectSpread(_objectSpread({},newField),{},{required:e.target.checked}))}),label:\"Required\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:2,children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"success\",onClick:handleAddField,disabled:!newField.name,fullWidth:true,startIcon:/*#__PURE__*/_jsx(AddCircleIcon,{}),children:\"Add Field\"})})]})]})]})]})})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleCloseDialog,color:\"inherit\",children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleSave,variant:\"contained\",color:\"primary\",disabled:!(editingDocType!==null&&editingDocType!==void 0&&editingDocType.name)||!(editingDocType!==null&&editingDocType!==void 0&&editingDocType.code),startIcon:/*#__PURE__*/_jsx(EditIcon,{}),children:\"Save\"})]})]})]});};export default DocumentTypesPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}