{"ast":null,"code":"import _objectSpread from\"C:/Users/Administrator/Desktop/bika/bika/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from\"react\";import{Box,Button,Card,Typography,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,Dialog,DialogTitle,DialogContent,DialogActions,TextField,IconButton,Chip,styled,Pagination,InputAdornment,TableSortLabel,Alert,Snackbar,CircularProgress,FormControlLabel,Switch}from\"@mui/material\";import{Add as AddIcon,Edit as EditIcon,Delete as DeleteIcon,Search as SearchIcon}from\"@mui/icons-material\";import{tokens}from\"../../theme/theme\";import{companyService}from\"../../services/api\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const HeaderBox=styled(Box)({display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\",marginBottom:24});const StyledCard=styled(Card)(_ref=>{let{theme}=_ref;return{borderRadius:16,boxShadow:\"0 4px 12px rgba(0, 0, 0, 0.05)\"};});const StyledTableCell=styled(TableCell)(_ref2=>{let{theme}=_ref2;return{borderBottom:\"1px solid \".concat(theme.palette.divider)};});const StatusChip=styled(Chip)(_ref3=>{let{status,theme}=_ref3;return{backgroundColor:status?tokens.secondary.main:theme.palette.grey[400],color:theme.palette.common.white,fontWeight:500,fontSize:\"0.75rem\"};});const LoadingContainer=styled(Box)({display:\"flex\",justifyContent:\"center\",alignItems:\"center\",height:\"400px\"});const Companies=()=>{const[companies,setCompanies]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[success,setSuccess]=useState(null);// Dialog states\nconst[createDialogOpen,setCreateDialogOpen]=useState(false);const[editDialogOpen,setEditDialogOpen]=useState(false);const[deleteDialogOpen,setDeleteDialogOpen]=useState(false);const[editingCompany,setEditingCompany]=useState(null);const[deletingCompany,setDeletingCompany]=useState(null);// Form state\nconst[formData,setFormData]=useState({name:\"\",code:\"\",email:\"\",phone:\"\",address:\"\",description:\"\",isActive:true});const[formErrors,setFormErrors]=useState({});const[submitting,setSubmitting]=useState(false);// Table state\nconst[search,setSearch]=useState(\"\");const[page,setPage]=useState(1);const[orderBy,setOrderBy]=useState(\"name\");const[order,setOrder]=useState(\"asc\");const rowsPerPage=10;// Load companies on component mount\nuseEffect(()=>{loadCompanies();},[]);const loadCompanies=async()=>{try{setLoading(true);setError(null);const data=await companyService.getCompanies();setCompanies(data);}catch(err){var _err$response,_err$response$data;setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||\"Failed to load companies\");}finally{setLoading(false);}};const validateForm=()=>{const errors={};if(!formData.name.trim())errors.name=\"Company name is required\";if(!formData.code.trim())errors.code=\"Company code is required\";if(!formData.email.trim())errors.email=\"Email is required\";else if(!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email)){errors.email=\"Please enter a valid email address\";}// Check for duplicate code (excluding current company when editing)\nconst duplicateCode=companies.find(company=>company.code.toLowerCase()===formData.code.toLowerCase()&&company.id!==(editingCompany===null||editingCompany===void 0?void 0:editingCompany.id));if(duplicateCode){errors.code=\"Company code already exists\";}// Check for duplicate email (excluding current company when editing)\nconst duplicateEmail=companies.find(company=>company.email.toLowerCase()===formData.email.toLowerCase()&&company.id!==(editingCompany===null||editingCompany===void 0?void 0:editingCompany.id));if(duplicateEmail){errors.email=\"Email already exists\";}setFormErrors(errors);return Object.keys(errors).length===0;};const resetForm=()=>{setFormData({name:\"\",code:\"\",email:\"\",phone:\"\",address:\"\",description:\"\",isActive:true});setFormErrors({});};const handleCreateOpen=()=>{resetForm();setCreateDialogOpen(true);};const handleCreateClose=()=>{setCreateDialogOpen(false);resetForm();};const handleEditOpen=company=>{setEditingCompany(company);setFormData({name:company.name,code:company.code,email:company.email,phone:company.phone||\"\",address:company.address||\"\",description:company.description||\"\",isActive:company.isActive});setFormErrors({});setEditDialogOpen(true);};const handleEditClose=()=>{setEditDialogOpen(false);setEditingCompany(null);resetForm();};const handleDeleteOpen=company=>{setDeletingCompany(company);setDeleteDialogOpen(true);};const handleDeleteClose=()=>{setDeleteDialogOpen(false);setDeletingCompany(null);};const handleCreate=async()=>{if(!validateForm())return;try{setSubmitting(true);const createData={name:formData.name.trim(),code:formData.code.trim(),email:formData.email.trim(),phone:formData.phone.trim()||undefined,address:formData.address.trim()||undefined,description:formData.description.trim()||undefined,isActive:formData.isActive};await companyService.createCompany(createData);setSuccess(\"Company created successfully\");handleCreateClose();loadCompanies();}catch(err){var _err$response2,_err$response2$data;setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.message)||\"Failed to create company\");}finally{setSubmitting(false);}};const handleUpdate=async()=>{if(!editingCompany||!validateForm())return;try{setSubmitting(true);const updateData={name:formData.name.trim(),code:formData.code.trim(),email:formData.email.trim(),phone:formData.phone.trim()||undefined,address:formData.address.trim()||undefined,description:formData.description.trim()||undefined,isActive:formData.isActive};await companyService.updateCompany(editingCompany.id,updateData);setSuccess(\"Company updated successfully\");handleEditClose();loadCompanies();}catch(err){var _err$response3,_err$response3$data;setError(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.message)||\"Failed to update company\");}finally{setSubmitting(false);}};const handleDelete=async()=>{if(!deletingCompany)return;try{setSubmitting(true);await companyService.deleteCompany(deletingCompany.id);setSuccess(\"Company deleted successfully\");handleDeleteClose();loadCompanies();}catch(err){var _err$response4,_err$response4$data;setError(((_err$response4=err.response)===null||_err$response4===void 0?void 0:(_err$response4$data=_err$response4.data)===null||_err$response4$data===void 0?void 0:_err$response4$data.message)||\"Failed to delete company\");}finally{setSubmitting(false);}};const handleInputChange=field=>event=>{const value=event.target.type==='checkbox'?event.target.checked:event.target.value;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:value}));// Clear error when user starts typing\nif(formErrors[field]){setFormErrors(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:undefined}));}};const handleSort=property=>{const isAsc=orderBy===property&&order===\"asc\";setOrder(isAsc?\"desc\":\"asc\");setOrderBy(property);};// Filter and sort companies\nconst filteredCompanies=companies.filter(company=>Object.values(company).join(\" \").toLowerCase().includes(search.toLowerCase()));const sortedCompanies=[...filteredCompanies].sort((a,b)=>{var _a$orderBy,_b$orderBy;const aValue=(_a$orderBy=a[orderBy])!==null&&_a$orderBy!==void 0?_a$orderBy:\"\";const bValue=(_b$orderBy=b[orderBy])!==null&&_b$orderBy!==void 0?_b$orderBy:\"\";if(typeof aValue==='string'&&typeof bValue==='string'){return order===\"asc\"?aValue.localeCompare(bValue):bValue.localeCompare(aValue);}if(aValue<bValue)return order===\"asc\"?-1:1;if(aValue>bValue)return order===\"asc\"?1:-1;return 0;});// Pagination\nconst paginatedCompanies=sortedCompanies.slice((page-1)*rowsPerPage,page*rowsPerPage);const pageCount=Math.ceil(sortedCompanies.length/rowsPerPage);if(loading){return/*#__PURE__*/_jsx(LoadingContainer,{children:/*#__PURE__*/_jsx(CircularProgress,{})});}return/*#__PURE__*/_jsxs(Box,{sx:{p:3},children:[/*#__PURE__*/_jsxs(HeaderBox,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",fontWeight:\"bold\",children:\"Companies Management\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),onClick:handleCreateOpen,sx:{borderRadius:2,textTransform:\"none\",fontWeight:500},children:\"Add Company\"})]}),/*#__PURE__*/_jsxs(StyledCard,{sx:{p:3},children:[/*#__PURE__*/_jsx(Box,{sx:{mb:3},children:/*#__PURE__*/_jsx(TextField,{placeholder:\"Search companies...\",value:search,onChange:e=>setSearch(e.target.value),InputProps:{startAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"start\",children:/*#__PURE__*/_jsx(SearchIcon,{})})},sx:{width:300}})}),/*#__PURE__*/_jsx(TableContainer,{children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(StyledTableCell,{children:/*#__PURE__*/_jsx(TableSortLabel,{active:orderBy===\"name\",direction:orderBy===\"name\"?order:\"asc\",onClick:()=>handleSort(\"name\"),children:\"Company Name\"})}),/*#__PURE__*/_jsx(StyledTableCell,{children:/*#__PURE__*/_jsx(TableSortLabel,{active:orderBy===\"code\",direction:orderBy===\"code\"?order:\"asc\",onClick:()=>handleSort(\"code\"),children:\"Code\"})}),/*#__PURE__*/_jsx(StyledTableCell,{children:/*#__PURE__*/_jsx(TableSortLabel,{active:orderBy===\"email\",direction:orderBy===\"email\"?order:\"asc\",onClick:()=>handleSort(\"email\"),children:\"Email\"})}),/*#__PURE__*/_jsx(StyledTableCell,{children:\"Phone\"}),/*#__PURE__*/_jsx(StyledTableCell,{children:\"Address\"}),/*#__PURE__*/_jsx(StyledTableCell,{children:\"Status\"}),/*#__PURE__*/_jsx(StyledTableCell,{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:paginatedCompanies.map(company=>/*#__PURE__*/_jsxs(TableRow,{hover:true,children:[/*#__PURE__*/_jsx(StyledTableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",fontWeight:500,children:company.name})}),/*#__PURE__*/_jsx(StyledTableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:company.code})}),/*#__PURE__*/_jsx(StyledTableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:company.email})}),/*#__PURE__*/_jsx(StyledTableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:company.phone||\"-\"})}),/*#__PURE__*/_jsx(StyledTableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:company.address||\"-\"})}),/*#__PURE__*/_jsx(StyledTableCell,{children:/*#__PURE__*/_jsx(StatusChip,{status:company.isActive,label:company.isActive?\"Active\":\"Inactive\",size:\"small\"})}),/*#__PURE__*/_jsxs(StyledTableCell,{children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleEditOpen(company),sx:{mr:1},children:/*#__PURE__*/_jsx(EditIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleDeleteOpen(company),color:\"error\",children:/*#__PURE__*/_jsx(DeleteIcon,{fontSize:\"small\"})})]})]},company.id))})]})}),pageCount>1&&/*#__PURE__*/_jsx(Box,{sx:{display:\"flex\",justifyContent:\"center\",mt:3},children:/*#__PURE__*/_jsx(Pagination,{count:pageCount,page:page,onChange:(_,newPage)=>setPage(newPage),color:\"primary\"})})]}),/*#__PURE__*/_jsxs(Dialog,{open:createDialogOpen,onClose:handleCreateClose,maxWidth:\"md\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Add New Company\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Box,{sx:{pt:2},children:[/*#__PURE__*/_jsx(TextField,{label:\"Company Name\",fullWidth:true,required:true,value:formData.name,onChange:handleInputChange(\"name\"),error:!!formErrors.name,helperText:formErrors.name,sx:{mb:2}}),/*#__PURE__*/_jsx(TextField,{label:\"Company Code\",fullWidth:true,required:true,value:formData.code,onChange:handleInputChange(\"code\"),error:!!formErrors.code,helperText:formErrors.code,sx:{mb:2}}),/*#__PURE__*/_jsx(TextField,{label:\"Email\",type:\"email\",fullWidth:true,required:true,value:formData.email,onChange:handleInputChange(\"email\"),error:!!formErrors.email,helperText:formErrors.email,sx:{mb:2}}),/*#__PURE__*/_jsx(TextField,{label:\"Phone\",fullWidth:true,value:formData.phone,onChange:handleInputChange(\"phone\"),sx:{mb:2}}),/*#__PURE__*/_jsx(TextField,{label:\"Address\",fullWidth:true,multiline:true,rows:2,value:formData.address,onChange:handleInputChange(\"address\"),sx:{mb:2}}),/*#__PURE__*/_jsx(TextField,{label:\"Description\",fullWidth:true,multiline:true,rows:3,value:formData.description,onChange:handleInputChange(\"description\"),sx:{mb:2}}),/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:formData.isActive,onChange:handleInputChange(\"isActive\")}),label:\"Active\"})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleCreateClose,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleCreate,variant:\"contained\",disabled:submitting,children:submitting?/*#__PURE__*/_jsx(CircularProgress,{size:20}):\"Create\"})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:editDialogOpen,onClose:handleEditClose,maxWidth:\"md\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Edit Company\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Box,{sx:{pt:2},children:[/*#__PURE__*/_jsx(TextField,{label:\"Company Name\",fullWidth:true,required:true,value:formData.name,onChange:handleInputChange(\"name\"),error:!!formErrors.name,helperText:formErrors.name,sx:{mb:2}}),/*#__PURE__*/_jsx(TextField,{label:\"Company Code\",fullWidth:true,required:true,value:formData.code,onChange:handleInputChange(\"code\"),error:!!formErrors.code,helperText:formErrors.code,sx:{mb:2}}),/*#__PURE__*/_jsx(TextField,{label:\"Email\",type:\"email\",fullWidth:true,required:true,value:formData.email,onChange:handleInputChange(\"email\"),error:!!formErrors.email,helperText:formErrors.email,sx:{mb:2}}),/*#__PURE__*/_jsx(TextField,{label:\"Phone\",fullWidth:true,value:formData.phone,onChange:handleInputChange(\"phone\"),sx:{mb:2}}),/*#__PURE__*/_jsx(TextField,{label:\"Address\",fullWidth:true,multiline:true,rows:2,value:formData.address,onChange:handleInputChange(\"address\"),sx:{mb:2}}),/*#__PURE__*/_jsx(TextField,{label:\"Description\",fullWidth:true,multiline:true,rows:3,value:formData.description,onChange:handleInputChange(\"description\"),sx:{mb:2}}),/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:formData.isActive,onChange:handleInputChange(\"isActive\")}),label:\"Active\"})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleEditClose,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleUpdate,variant:\"contained\",disabled:submitting,children:submitting?/*#__PURE__*/_jsx(CircularProgress,{size:20}):\"Update\"})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:deleteDialogOpen,onClose:handleDeleteClose,maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Confirm Delete\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Typography,{children:[\"Are you sure you want to delete the company \\\"\",deletingCompany===null||deletingCompany===void 0?void 0:deletingCompany.name,\"\\\"? This action cannot be undone.\"]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleDeleteClose,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleDelete,variant:\"contained\",color:\"error\",disabled:submitting,children:submitting?/*#__PURE__*/_jsx(CircularProgress,{size:20}):\"Delete\"})]})]}),/*#__PURE__*/_jsx(Snackbar,{open:!!success,autoHideDuration:4000,onClose:()=>setSuccess(null),children:/*#__PURE__*/_jsx(Alert,{onClose:()=>setSuccess(null),severity:\"success\",children:success})}),/*#__PURE__*/_jsx(Snackbar,{open:!!error,autoHideDuration:6000,onClose:()=>setError(null),children:/*#__PURE__*/_jsx(Alert,{onClose:()=>setError(null),severity:\"error\",children:error})})]});};export default Companies;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}